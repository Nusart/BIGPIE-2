<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />

	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#85C1E9">

	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#85C1E9">

	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#85C1E9">

	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable= no, shrink-to-fit=no" />
	<title>iGEM 2020</title>
	<link rel="preload" href="../T--IISER_Bhopal--loader.mp4" as="video" type="video/mp4">

	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css">
	<script src="https://kit.fontawesome.com/df7451b09d.js" crossorigin="anonymous"></script>

	<link rel="stylesheet" href="../Common/bootstrap.min.css" />
	<link rel="stylesheet" href="../Common/animations.min.css" />
	<link rel="stylesheet" href="Modelling.css" />

	<script src="../Common/NavBar/jquery-3.5.1.min.js" charset="utf-8"></script>
	<script src="../Common/NavBar/bootstrap.min.js" charset="utf-8"></script>

	<link rel="stylesheet" href="../Common/Pre-footer_buttons/footer_button_style.css" />
	<link rel="stylesheet" href="../Common/NavBar/custom-navbar.css" />


	<link href="https://fonts.googleapis.com/css2?family=Merriweather&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Lato:wght@300&display=swap" rel="stylesheet">
</head>

<body>
	<div class="loader">
		<video autoplay muted loop src="../Common/T--IISER_Bhopal--Loader.mp4"></video>
	</div>

	<!--Loader-->
	<script type="text/javascript">
		window.addEventListener("load", function() {
			const loader = document.querySelector(".loader");
			loader.className += " hidden"; // new class = "loader hidden"
		});
	</script>

	<header>
		<nav class="navbar smart-scroll fixed-top navbar-expand-lg navbar-dark scrolling-navbar py-0" id="mynav">
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse justify-content-between navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav mr-auto">
					<li class="nav-item navbar-nav mr-auto active">
						<a class="nav-link" href="../index.html"> <i class="fas fa-home"></i> <span class="sr-only">(current)</span></a>
					</li>
				</ul>
				<ul class="navbar-nav ml-auto">
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<i class="fas fa-project-diagram"></i> Project
						</a>
						<div class="dropdown-menu dropdown-menu-right animate slideIn" aria-labelledby="navbarDropdown">
							<a class="dropdown-item" href="../Description/index.html">Description</a>
							<a class="dropdown-item" href="../Design/index.html">Design</a>
							<a class="dropdown-item" href="../coming_soon/coming_soon.html">Modelling</a>
							<a class="dropdown-item" href="../coming_soon/coming_soon.html">Engineering Success</a>
						</div>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<i class="fas fa-puzzle-piece"></i> Parts
						</a>
						<div class="dropdown-menu dropdown-menu-right animate slideIn" aria-labelledby="navbarDropdown">
							<a class="dropdown-item" href="../Parts/Parts.html">Parts Collection</a>
							<a class="dropdown-item" href="../Contributions/index.html">Contribution</a>
						</div>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<i class="fas fa-handshake"></i> Human Practices
						</a>
						<div class="dropdown-menu dropdown-menu-right animate slideIn" aria-labelledby="navbarDropdown">
							<a class="dropdown-item" href="../coming_soon/coming_soon.html">IHP</a>
							<a class="dropdown-item" href="../coming_soon/coming_soon.html">Education</a>
							<a class="dropdown-item" href="../Collaborations/index.html">Collaborations</a>
						</div>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<i class="fas fa-users"></i> About Us
						</a>
						<div class="dropdown-menu dropdown-menu-right animate slideIn" aria-labelledby="navbarDropdown">
							<a class="dropdown-item" href="../coming_soon/coming_soon.html">Team</a>
							<a class="dropdown-item" href="../coming_soon/coming_soon.html">Supervisors</a>
							<a class="dropdown-item" href="../Collaborations/index.html">Attributors</a>
						</div>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<i class="fas fa-biohazard"></i> Safety
						</a>
						<div class="dropdown-menu dropdown-menu-right animate slideIn" aria-labelledby="navbarDropdown">
							<a class="dropdown-item" href="../Biosafety/index.html">Biosafety</a>
							<a class="dropdown-item" href="../Biosafety/index.html">Biosecurity</a>
							<a class="dropdown-item" href="../Biosafety/index.html">Safe by Design</a>
						</div>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<i class="fa fa-gavel"></i> Judging Forms
						</a>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<i class="fa fa-cog"></i> Implementation
						</a>
						<div class="dropdown-menu dropdown-menu-right animate slideIn" aria-labelledby="navbarDropdown">
							<a class="dropdown-item" href="../coming_soon/coming_soon.html">Overview</a>
							<a class="dropdown-item" href="../coming_soon/coming_soon.html">Preliminary Research</a>
							<a class="dropdown-item" href="../coming_soon/coming_soon.html">Clinical Trials</a>
							<a class="dropdown-item" href="../Entrepreneurship/index.html">Entrepreneurship</a>
						</div>
					</li>
				</ul>
			</div>
		</nav>
	</header>
	<script type="text/javascript" src="../Common/NavBar/custom-navbar.js"></script>

	<main>
		<div id="cta">
			<div class="desc-title">
				<h1> Title </h1>
			</div>
		</div>
	</main>

	<script src="https://3Dmol.csb.pitt.edu/build/3Dmol-min.js"></script>





	<div class="container molviewr text-center">
		<div style="height: 400px; width: 400px;" class='viewer_3Dmoljs' data-pdb='PDX1_residue_M3' data-backgroundcolor='0x0000000' data-style='stick'></div>
	</div>



	<div class="container">
		<section class="pre-footer-button-container">
			<ul class="ch-grid">
				<li>
					<div class="ch-item ch-img-1">
						<div class="ch-info">
							<a href="../Description/index.html">
								<h3>Description</h3>
								<p>Read More...<a href="#">Read More</a></p>
							</a>
						</div>
					</div>
				</li>

				<li>
					<div class="ch-item ch-img-2">
						<div class="ch-info">
							<a href="#">
								<h3>Design</h3>
								<p>Read More...<a href="#">Read More</a></p>
							</a>
						</div>
					</div>
				</li>

				<li>
					<div class="ch-item ch-img-3">
						<div class="ch-info">
							<h3>Parts</h3>
							<p>Read More...<a href="#">Read More</a></p>
						</div>
					</div>
				</li>

				<li>
					<div class="ch-item ch-img-5">
						<div class="ch-info">
							<h3>Human Practices</h3>
							<p>Read More...<a href="#">Read More</a></p>
						</div>
					</div>
				</li>

				<li>
					<div class="ch-item ch-img-6">
						<div class="ch-info">
							<h3>Model</h3>
							<p>Read More...<a href="#">Read More</a></p>
						</div>
					</div>
				</li>

				<li>
					<div class="ch-item ch-img-4">
						<div class="ch-info">
							<h3 style="font-size:0.75rem;">Entrepreneurship</h3>
							<p>Read More...<a href="#">Read More</a></p>
						</div>
					</div>
				</li>

				<li>
					<div class="ch-item ch-img-7">
						<div class="ch-info">
							<h3>Patent <br>Law</h3>
							<p>Read More...<a href="#">Read More</a></p>
						</div>
					</div>
				</li>

				<li>
					<div class="ch-item ch-img-8">
						<div class="ch-info">
							<a href="../Biosafety/index.html">
								<h3>Safety</h3>
								<p>Read More...<a href="#">Read More</a></p>
							</a>
						</div>
					</div>
				</li>

			</ul>
		</section>
	</div>




	<footer class="mainfooter" role="contentinfo">
		<div class="footer-middle">
			<div class="container">
				<div class="row">
					<div class="col-md-3 col-sm-6">
						<!--Column1-->
						<div class="footer-pad foot">
							<h4>BigPie</h4>
							<p>A project by Indian Institute of Science Education and Research Bhopal.</p>
							<p>iGEM 2020 team.</p>

						</div>
					</div>
					<div class="col-md-6 col-sm-12">
						<!--Column1-->
						<div class="footer-pad foot">
							<h4>Sponsers</h4>
							<ul class="list-unstyled">
								<li><a href="#">A</a></li>
								<li><a href="#">B</a></li>
								<li><a href="#">C</a></li>
								<li><a href="#">Disclaimer</a></li>
								<li><a href="#">E</a></li>
								<li><a href="#">FAQs</a></li>
							</ul>
						</div>
					</div>
					<!--
					<div class="col-md-3 col-sm-6">

					</div>
					-->
					<div class="col-md-3 foot">
						<h4>Follow Us</h4>
						<ul class="social-network social-circle">
							<li><a href="#" class="icoFacebook" title="Facebook"><i class="fa fa-facebook"></i></a></li>
							<li><a href="#" class="icoInstagram" title="Instagram"><i class="fa fa-instagram"></i></a></li>
							<li><a href="#" class="icoLinkedin" title="Linkedin"><i class="fa fa-linkedin"></i></a></li>
							<li><a href="#" class="icoGmail" title="Gmail"><i class="fa fa-envelope"></i></a></li>
						</ul>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12 copy foot">
						<p class="text-center">BIGPIE 2020</p>
					</div>
				</div>


			</div>
		</div>
	</footer>


	<script type="text/javascript" src=""></script>

	<script>
		// (c) Jan Dlabal, 2012.
		// http://houbysoft.com/
		// https://github.com/houbysoft/js-pdb/
		// Licensed under the GNU GPL v3 License.
		// requires Three.js and jquery.js
		// receives a single text line from a PDB file
		// returns that line parsed into an array containing:
		// - chain ID (single letter)
		// - x coordinate (float)
		// - y coordinate (float)
		// - z coordinate (float)
		function processPDBLine(line) {
			if (line.substr(0, 4) == "ATOM") {
				var res = new Array();
				res[0] = line[21]; // chain ID
				res[1] = parseFloat(line.substr(30, 8)); // x coordinate
				res[2] = parseFloat(line.substr(38, 8)); // y coordinate
				res[3] = parseFloat(line.substr(46, 8)); // z coordinate
				return res;
			} else {
				return -1;
			}
		}

		function lookAt(vector) {
			controls.target = vector;
			render();
		}
		// receives an entire PDB file in a string variable
		// returns an array of lines processed by processPDBLine()
		function processPDB(text) {
			text = text.split('\n');
			var res = new Array();
			for (i in text) {
				processedLine = processPDBLine(text[i]);
				if (processedLine != -1)
					res[res.length] = processedLine;
			}
			return res;
		}
		// generates an array of n colors to use for coloring the different chains
		function createColors(n) {
			var inc = 1.0 / n;
			var colors = new Array();
			var cur_hue;
			for (cur_hue = 0; cur_hue < 1.0; cur_hue += inc) {
				var cur_color = new THREE.Color();
				cur_color.setHSV(cur_hue, 1.0, 1.0);
				colors[colors.length] = cur_color.getHex();
			}
			return colors;
		}
		// renders the PDB that is currently in the pdb-input <textarea>
		function renderPDB() {
			if (typeof renderer == 'undefined') {
				if (window.addEventListener)
					document.addEventListener('DOMMouseScroll', mouseWheel, false);
				document.onmousewheel = mouseWheel;
				renderer = new THREE.WebGLRenderer({
					clearColor: 0x000000,
					clearAlpha: 1
				});
				WIDTH = HEIGHT = 600;
				renderer.setSize(WIDTH, HEIGHT);
				$('#js-pdb-render').append(renderer.domElement);
				camera = new THREE.PerspectiveCamera(
					35, // Field of view
					WIDTH / HEIGHT, // Aspect ratio
					.1, // Near
					10000 // Far
				);
				camera.position.set(90, 90, 90);
				light = new THREE.DirectionalLight(0xFFFFFF);
				light.position.set(0, 0, 1);
				light2 = new THREE.DirectionalLight(0xFFFFFF);
				light2.position.set(0, 0, -1);
				controls = new THREE.TrackballControls(camera, renderer.domElement);
				controls.rotateSpeed = 10.0;
				controls.zoomSpeed = 1.2;
				controls.panSpeed = 0.2;
				controls.noZoom = false;
				controls.noPan = false;
				controls.staticMoving = true;
				controls.dynamicDampingFactor = 1.0;
				var radius = 5;
				controls.minDistance = radius * 1.1;
				controls.maxDistance = radius * 100;
				controls.keys = [65, 83, 68]; // [ rotateKey, zoomKey, panKey ]
			}
			scene = new THREE.Scene();
			scene.add(camera);
			scene.add(light);
			scene.add(light2);
			var pdb = processPDB($('#pdb-input').val());
			this.chains = new Array();
			chains[0] = new THREE.Geometry();
			this.centerCoords = new Array(0, 0, 0);
			var cur_chain = pdb[0][0];
			var cur_chain_idx = 0;
			for (i in pdb) {
				if (pdb[i][0] != cur_chain) {
					cur_chain = pdb[i][0];
					cur_chain_idx++;
					chains[cur_chain_idx] = new THREE.Geometry();
				}
				chains[cur_chain_idx].vertices.push(new THREE.Vector3(pdb[i][1], pdb[i][2], pdb[i][3]));
				centerCoords[0] += pdb[i][1];
				centerCoords[1] += pdb[i][2];
				centerCoords[2] += pdb[i][3];
			}
			centerCoords[0] /= pdb.length;
			centerCoords[1] /= pdb.length;
			centerCoords[2] /= pdb.length;
			colors = createColors(chains.length);
			for (i in chains) {
				scene.add(createTube(new THREE.SplineCurve3(chains[i].vertices), colors[i]));
			}
			lookAt(new THREE.Vector3(centerCoords[0], centerCoords[1], centerCoords[2]));
			renderer.render(scene, camera);
			animate();
		}

		function animate() {
			requestAnimationFrame(animate);
			render();
		}

		function render() {
			controls.update();
			renderer.render(scene, camera);
		}

		function mouseWheel(event) {
			var delta = 0;
			if (!event) event = window.event;
			if (event.wheelDelta) {
				delta = event.wheelDelta / 120;
				if (window.opera) delta = -delta;
			} else if (event.detail) {
				delta = -event.detail / 3;
			}
			// handle the delta
			// TODO
		}

		function createTube(l, c) {
			var tube = new THREE.TubeGeometry(l, 1500, 0.01, 3, false, false);
			return THREE.SceneUtils.createMultiMaterialObject(tube, [
				new THREE.MeshLambertMaterial({
					color: c,
					opacity: 1.0,
					transparent: true
				}),
				/*new THREE.MeshBasicMaterial({
				color: 0xFFFFFF,
				opacity: 0.5,
				wireframe: false
				})*/
			]);
		}

		logRuntimeToConsole = function(f) {
			return function() {
				var start = new Date().getTime();
				var result = f.apply(this, arguments)
				var end = new Date().getTime();
				var time = end - start;
				console.info('Execution time of ' + f.name + ': ' + time + "ms");
				return result;
			}
		}

		PDBDATA = new function() {
			this.pdbdata = {};
			this.setPDBdata = function(newDATA) {
				this.pdbdata = newDATA;
				//displayPDB(this.pdbdata);
			}
		};

		var PDBFIELDNAMES = {
			1: ["ATorHET", String.trim, ""],
			2: ["serial", parseInt, NaN],
			3: ["atom", String.trim, ""],
			4: ["altloc", String.trim, ""],
			5: ["resname", String.trim, ""],
			6: ["chainid", String.trim, ""],
			7: ["resseq", parseInt, ""],
			8: ["icode", String.trim, ""],
			9: ["x", parseFloat, NaN],
			10: ["y", parseFloat, NaN],
			11: ["z", parseFloat, NaN],
			12: ["occupancy", parseFloat, NaN],
			13: ["tempFactor", parseFloat, NaN],
			14: ["ignored", parseFloat, ""],
			15: ["element", String.trim, ""],
			16: ["charge", parseFloat, NaN],
		};

		$("#log").hide();

		$(document).ajaxError(function(e, xhr, opt) {
			$("#log").text("Error requesting " + opt.url + ": " + xhr.status + " " + xhr.statusText).show();
		});

		$("#bt_load").click(function() {
			var query = $("#inputPDBid").val();
			var url = "PDX1_residue_M3" + query + ".pdb";
			var that = this;
			$("#log").hide();
			$.get(url, function(ret) {
				console.debug("got pdb data for " + query);
				proccessPDB(ret);
			}).fail(function() {
				console.error("could not retrive PDB data for " + this.pdbcode);
			})

		});

		$("#bt_display").click(function() {
			displayPDB(PDBDATA.pdbdata);
		});

		function proccessPDB(pdbdata) {
			console.info("proccessPDB");
			console.info(JSON.stringify(pdbdata));
			var re = /(ATOM  |HETATM)\s*(\d+)\s([A-Z0-9 ]{4})\s*([\w ])([A-Z]{3})\s(\w)\s*(\d*)([A-Za-z ])\s+([+-]?[\d]+\.\d{3})\s*([+-]?[\d]+\.\d{3})\s*([+-]?[\d]+\.\d{3})\s*([+-]?[\d]+\.\d{2})\s+([+-]?[\d]+\.\d{2})([\s\d+-\.]*)(\w{0,2}).*/gm;

			var m;
			var line_no = 0;
			var max_lines = 0;
			var result = [];
			while ((m = re.exec(pdbdata)) != null) {
				line_no += 1;
				if (m.index === re.lastIndex) {
					re.lastIndex++;
				}
				var atom = {};
				for (var i = 1; i < 17; ++i) {
					var field = PDBFIELDNAMES[i];
					var key = field[0];
					var val = field[1](m[i]);
					atom[key] = val;
				}
				if (line_no < max_lines)
					console.info(atom);
				if (line_no == max_lines)
					console.info("...");
				result.push(atom);
			}

			PDBDATA.setPDBdata(result);

		};
		proccessPDB = logRuntimeToConsole(proccessPDB);

		displayPDB = function(parsedPDB) {
			console.info("displayPDB", parsedPDB.length);

			var counter = 1;
			$('#example').DataTable().destroy();
			var t = $('#example').DataTable({
				"data": parsedPDB,
				"columns": cols
			});

			var i = 0;
		}
		displayPDB = logRuntimeToConsole(displayPDB);

		var cols = [];
		$.each(PDBFIELDNAMES, function(i, c) {
			cols.push({
				data: c[0]
			});
		});

		var t = $('#example').DataTable({
			"columns": cols
		});
	</script>

	<script type="text/javascript" src="../Common/css3-animate-it.js"></script>
</body></html>